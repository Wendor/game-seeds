(function(){"use strict";const a={ROW_SIZE:9,BOT_SEARCH_LIMIT:3e3,SCORE:{VERTICAL:120,SAME_VALUE:15,CHAIN_REACTION:40,POSITION_PENALTY:.005}},i=a.ROW_SIZE,h=(e,r,o)=>{const n=e[r];return n?n.next===o||n.prev===o:!1},I=(e,r,o)=>{const n=r%i,c=o%i;if(n!==c)return!1;const t=Math.min(r,o),s=Math.max(r,o);for(let f=t+i;f<s;f+=i){const u=e[f];if(u&&u.status!=="crossed")return!1}return!0},E=(e,r,o)=>{const n=e[r],c=e[o];return!n||!c||n.status==="crossed"||c.status==="crossed"||n.value!==c.value&&n.value+c.value!==10?!1:h(e,r,o)||I(e,r,o)},C=(e,r)=>{const o=[],n=e[r];if(!n)return[];n.prev!==null&&n.prev!==void 0&&o.push(n.prev),n.next!==null&&n.next!==void 0&&o.push(n.next);const c=e.length;for(let t=r+i;t<c;t+=i){const s=e[t];if(s&&s.status!=="crossed"){o.push(t);break}}for(let t=r-i;t>=0;t-=i){const s=e[t];if(s&&s.status!=="crossed"){o.push(t);break}}return o},M=(e,r,o)=>{const n=e[r],c=e[o];if(!n||!c)return 0;let t=10;if(r%i===o%i&&(t+=a.SCORE.VERTICAL),n.value===c.value&&(t+=a.SCORE.SAME_VALUE),t-=r*a.SCORE.POSITION_PENALTY,h(e,r,o)){const f=Math.min(r,o),u=Math.max(r,o),v=e[f].prev,d=e[u].next;if(v!=null&&d!==null&&d!==void 0){const l=e[v],p=e[d];l&&p&&l.status!=="crossed"&&p.status!=="crossed"&&(l.value===p.value||l.value+p.value===10)&&(t+=a.SCORE.CHAIN_REACTION)}}return t},O=(e,r,o)=>{const n=[],c=e[r],t=e[o];if(!c||!t)return[];if(c.status="crossed",t.status="crossed",c.prev!==null&&c.prev!==void 0){const s=e[c.prev];s&&(n.push({index:c.prev,field:"next",oldValue:s.next}),s.next=c.next)}if(c.next!==null&&c.next!==void 0){const s=e[c.next];s&&(n.push({index:c.next,field:"prev",oldValue:s.prev}),s.prev=c.prev)}if(t.prev!==null&&t.prev!==void 0){const s=e[t.prev];s&&(n.push({index:t.prev,field:"next",oldValue:s.next}),s.next=t.next)}if(t.next!==null&&t.next!==void 0){const s=e[t.next];s&&(n.push({index:t.next,field:"prev",oldValue:s.prev}),s.prev=t.prev)}return n},A=(e,r,o,n)=>{e[r]&&(e[r].status="active"),e[o]&&(e[o].status="active");for(let c=n.length-1;c>=0;c--){const t=n[c];if(!t)continue;const s=e[t.index];s&&(s[t.field]=t.oldValue)}},R=(e,r=-1)=>{const o=[],n=e.length,c=n>4e3?a.BOT_SEARCH_LIMIT:n;for(let t=0;t<c;t++){const s=e[t];if(!s||s.status==="crossed")continue;const f=C(e,t);for(const u of f)if(u>t&&E(e,t,u)){const v=M(e,t,u);o.push({idx1:t,idx2:u,score:v})}}return o.sort((t,s)=>s.score-t.score),r>0&&o.length>r?o.slice(0,r):o},x=(e,r)=>{const o=R(e,8);if(o.length===0)return{score:0,move:null};let n=-1/0,c=null;for(const t of o){let s=t.score;if(r>0){const f=O(e,t.idx1,t.idx2),u=x(e,r-1);s+=u.score*.6,A(e,t.idx1,t.idx2,f)}s>n&&(n=s,c=[t.idx1,t.idx2])}return{score:n,move:c}};self.onmessage=e=>{const{type:r,cells:o}=e.data;if(r==="find"){const n=x(o,1);self.postMessage({type:"moveFound",move:n.move})}}})();
