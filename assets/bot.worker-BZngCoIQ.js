(function(){"use strict";const i={ROW_SIZE:9}.ROW_SIZE,d=(e,r,o)=>{const n=e[r];return n?n.next===o||n.prev===o:!1},x=(e,r,o)=>{const n=r%i,c=o%i;if(n!==c)return!1;const t=Math.min(r,o),s=Math.max(r,o);for(let f=t+i;f<s;f+=i){const u=e[f];if(u&&u.status!=="crossed")return!1}return!0},g=(e,r,o)=>{const n=e[r],c=e[o];return!n||!c||n.status==="crossed"||c.status==="crossed"||n.value!==c.value&&n.value+c.value!==10?!1:d(e,r,o)||x(e,r,o)},M=(e,r)=>{const o=[],n=e[r];if(!n)return[];n.prev!==null&&n.prev!==void 0&&o.push(n.prev),n.next!==null&&n.next!==void 0&&o.push(n.next);const c=e.length;for(let t=r+i;t<c;t+=i){const s=e[t];if(s&&s.status!=="crossed"){o.push(t);break}}for(let t=r-i;t>=0;t-=i){const s=e[t];if(s&&s.status!=="crossed"){o.push(t);break}}return o},m=(e,r,o)=>{const n=e[r],c=e[o];if(!n||!c)return 0;let t=10;if(r%i===o%i&&(t+=120),n.value===c.value&&(t+=15),t-=r*.005,d(e,r,o)){const f=Math.min(r,o),u=Math.max(r,o),a=e[f].prev,p=e[u].next;if(a!=null&&p!==null&&p!==void 0){const v=e[a],l=e[p];v&&l&&v.status!=="crossed"&&l.status!=="crossed"&&(v.value===l.value||v.value+l.value===10)&&(t+=40)}}return t},b=(e,r,o)=>{const n=[],c=e[r],t=e[o];if(!c||!t)return[];if(c.status="crossed",t.status="crossed",c.prev!==null&&c.prev!==void 0){const s=e[c.prev];s&&(n.push({index:c.prev,field:"next",oldValue:s.next}),s.next=c.next)}if(c.next!==null&&c.next!==void 0){const s=e[c.next];s&&(n.push({index:c.next,field:"prev",oldValue:s.prev}),s.prev=c.prev)}if(t.prev!==null&&t.prev!==void 0){const s=e[t.prev];s&&(n.push({index:t.prev,field:"next",oldValue:s.next}),s.next=t.next)}if(t.next!==null&&t.next!==void 0){const s=e[t.next];s&&(n.push({index:t.next,field:"prev",oldValue:s.prev}),s.prev=t.prev)}return n},I=(e,r,o,n)=>{e[r]&&(e[r].status="active"),e[o]&&(e[o].status="active");for(let c=n.length-1;c>=0;c--){const t=n[c];if(!t)continue;const s=e[t.index];s&&(s[t.field]=t.oldValue)}},V=(e,r=-1)=>{const o=[],n=e.length,c=n>4e3?3e3:n;for(let t=0;t<c;t++){const s=e[t];if(!s||s.status==="crossed")continue;const f=M(e,t);for(const u of f)if(u>t&&g(e,t,u)){const a=m(e,t,u);o.push({idx1:t,idx2:u,score:a})}}return o.sort((t,s)=>s.score-t.score),r>0&&o.length>r?o.slice(0,r):o},h=(e,r)=>{const o=V(e,8);if(o.length===0)return{score:0,move:null};let n=-1/0,c=null;for(const t of o){let s=t.score;if(r>0){const f=b(e,t.idx1,t.idx2),u=h(e,r-1);s+=u.score*.6,I(e,t.idx1,t.idx2,f)}s>n&&(n=s,c=[t.idx1,t.idx2])}return{score:n,move:c}};self.onmessage=e=>{const{type:r,cells:o}=e.data;if(r==="find"){const n=h(o,1);self.postMessage({type:"moveFound",move:n.move})}}})();
