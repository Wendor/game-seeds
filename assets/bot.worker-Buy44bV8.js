(function(){"use strict";const a=(t,c,s)=>{const o=t[c];return o?o.next===s||o.prev===s:!1},v=(t,c,s)=>{const o=c%9,r=s%9;if(o!==r)return!1;const e=Math.min(c,s),n=Math.max(c,s);for(let i=e+9;i<n;i+=9){const u=t[i];if(u&&u.status!=="crossed")return!1}return!0},l=(t,c,s)=>{const o=t[c],r=t[s];return!o||!r||o.status==="crossed"||r.status==="crossed"||o.value!==r.value&&o.value+r.value!==10?!1:a(t,c,s)||v(t,c,s)},p=(t,c)=>{const s=[],o=t[c];if(!o)return[];o.prev!==null&&o.prev!==void 0&&s.push(o.prev),o.next!==null&&o.next!==void 0&&s.push(o.next);const r=t.length,e=9;for(let n=c+e;n<r;n+=e){const i=t[n];if(i&&i.status!=="crossed"){s.push(n);break}}for(let n=c-e;n>=0;n-=e){const i=t[n];if(i&&i.status!=="crossed"){s.push(n);break}}return s},d=(t,c,s)=>{const o=t[c],r=t[s];if(!o||!r)return 0;let e=10;return c%9===s%9&&(e+=100),o.value===r.value&&(e+=15),e-=c*.005,e},h=(t,c,s)=>{const o=[],r=t[c],e=t[s];if(!r||!e)return[];if(r.status="crossed",e.status="crossed",r.prev!==null&&r.prev!==void 0){const n=t[r.prev];n&&(o.push({index:r.prev,field:"next",oldValue:n.next}),n.next=r.next)}if(r.next!==null&&r.next!==void 0){const n=t[r.next];n&&(o.push({index:r.next,field:"prev",oldValue:n.prev}),n.prev=r.prev)}if(e.prev!==null&&e.prev!==void 0){const n=t[e.prev];n&&(o.push({index:e.prev,field:"next",oldValue:n.next}),n.next=e.next)}if(e.next!==null&&e.next!==void 0){const n=t[e.next];n&&(o.push({index:e.next,field:"prev",oldValue:n.prev}),n.prev=e.prev)}return o},x=(t,c,s,o)=>{t[c]&&(t[c].status="active"),t[s]&&(t[s].status="active");for(let r=o.length-1;r>=0;r--){const e=o[r];if(!e)continue;const n=t[e.index];n&&(n[e.field]=e.oldValue)}},g=(t,c=-1)=>{const s=[],o=t.length,r=o>3e3?2500:o;for(let e=0;e<r;e++){const n=t[e];if(!n||n.status==="crossed")continue;const i=p(t,e);for(const u of i)if(u>e&&l(t,e,u)){const M=d(t,e,u);s.push({idx1:e,idx2:u,score:M})}}return s.sort((e,n)=>n.score-e.score),c>0&&s.length>c?s.slice(0,c):s},f=(t,c)=>{const s=g(t,5);if(s.length===0)return{score:0,move:null};let o=-1/0,r=null;for(const e of s){let n=e.score;if(c>0){const i=h(t,e.idx1,e.idx2),u=f(t,c-1);n+=u.score*.5,x(t,e.idx1,e.idx2,i)}n>o&&(o=n,r=[e.idx1,e.idx2])}return{score:o,move:r}};self.onmessage=t=>{const{type:c,cells:s}=t.data;if(c==="find"){const o=f(s,1);self.postMessage({type:"moveFound",move:o.move})}}})();
