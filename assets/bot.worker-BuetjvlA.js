(function(){"use strict";const g=(t,s,n)=>{const e=t[s];return e?e.next===n||e.prev===n:!1},b=(t,s,n)=>{const e=s%9,o=n%9;if(e!==o)return!1;const r=Math.min(s,n),c=Math.max(s,n);for(let u=r+9;u<c;u+=9){const i=t[u];if(i&&i.status!=="crossed")return!1}return!0},M=(t,s,n)=>{const e=t[s],o=t[n];return!e||!o||e.status==="crossed"||o.status==="crossed"||e.value!==o.value&&e.value+o.value!==10?!1:g(t,s,n)||b(t,s,n)},m=(t,s)=>{const n=[],e=t[s];if(!e)return[];e.prev!==null&&e.prev!==void 0&&n.push(e.prev),e.next!==null&&e.next!==void 0&&n.push(e.next);const o=t.length,r=9;for(let c=s+r;c<o;c+=r){const u=t[c];if(u&&u.status!=="crossed"){n.push(c);break}}for(let c=s-r;c>=0;c-=r){const u=t[c];if(u&&u.status!=="crossed"){n.push(c);break}}return n},N=(t,s)=>{const n=t[s];if(n&&n.prev!==void 0&&n.prev!==null)return n.prev;for(let e=s-1;e>=0;e--){const o=t[e];if(o&&o.status!=="crossed")return e}return null},k=(t,s)=>{const n=t[s];if(n&&n.next!==void 0&&n.next!==null)return n.next;for(let e=s+1;e<t.length;e++){const o=t[e];if(o&&o.status!=="crossed")return e}return null},x=(t,s)=>t.value===s.value||t.value+s.value===10,V=t=>{const s=t.length,n=s>5e3?4e3:s,e=[];for(let r=0;r<n;r++){const c=t[r];if(!c||c.status==="crossed")continue;const u=m(t,r);for(const i of u)if(i>r&&M(t,r,i)){const a=t[i];if(!a)continue;let f=10;const l=r%9===i%9;if(l&&(f+=150),c.value===a.value&&(f+=20),!l){const v=N(t,r),h=k(t,i);if(v!==null&&h!==null){const p=t[v],d=t[h];p&&d&&x(p,d)&&(f+=500)}}f-=r*.001,e.push({idx1:r,idx2:i,score:f})}}if(e.length===0)return null;e.sort((r,c)=>c.score-r.score);const o=e[0];return o?[o.idx1,o.idx2]:null};self.onmessage=t=>{const{type:s,cells:n}=t.data;if(s==="find"){const e=V(n);self.postMessage({type:"moveFound",move:e})}}})();
